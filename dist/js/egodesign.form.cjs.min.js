"use strict";function t(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)}"function"==typeof SuppressedError&&SuppressedError;const e=({element:t,enter:e,time:i,displayType:s,callback:r})=>{t.style.opacity=e?"0":"1",e&&(t.style.display=s);let a=(new Date).getTime();!function s(){t.style.opacity=e?(+t.style.opacity+((new Date).getTime()-a)/i).toString():(+t.style.opacity-((new Date).getTime()-a)/i).toString(),a=(new Date).getTime(),e&&Number(t.style.opacity)<1||!e&&Number(t.style.opacity)>0?requestAnimationFrame(s)||setTimeout(s,16):(e||(t.style.display="none"),r&&"function"==typeof r&&r())}()},i=({element:t,className:e})=>{if(!t)return null;for(;t&&!t.classList.contains(e);)t=t.parentElement?t.parentElement:null;return t};function s(t,e="log"){"log"==e?console.log("::EgoForm:: "+t):"data"==e&&(console.log("::EgoForm:: DATA"),console.table(t))}const r={default:{empty:"Campo requerido.",invalid:"Campo nó válido.",minLength:"Debe tener al menos [[var]] caracteres.",maxLength:"Debe tener como máximo [[var]] caracteres."},email:{empty:"El email es requerido.",invalid:"El email no es válido."},message:{empty:"El mensaje es requerido."},password:{empty:"Ingrese una contraseña."},password_repeat:{empty:"Debe repetir la contraseña.",unequal:"Las contraseñas no coindicen."},cuil:{empty:"Campo requerido.",min:"El número debe tener exactamente 11 dígitos.",invalid:"El número ingresado no es válido."},url:{empty:"Campo requerido.",invalid:"URL no válida."},file:{empty:"Campo requerido",min_size:"El tamaño mínimo es [[var]]",max_size:"El tamaño máximo es [[var]]"}};class a{constructor({customValidations:t,classes:e,customValidationMessages:i,debug:s}){this.customValidations=t,this.validationMessages={...r,...i},this.classes=e,this.debug=s}validateField({field:t}){const e=t.dataset.type||"",i=["radio","checkbox"].includes(e),r=t.classList.contains(this.classes.requiredField),a=t.classList.contains(this.classes.requiredIfFilledField),o=t.querySelector(".form__error"),l=t.querySelector(".form__control"),n=i?t.querySelector(".form__control:checked"):null,u=l?l.getAttribute("name"):null,d=Object.keys(this.customValidations),c=t.dataset.minLength?Number(t.dataset.minLength):null,h=t.dataset.maxLength?Number(t.dataset.maxLength):null;if(l||this.throwError("control not found."),u||this.throwError("control name not found."),this.debug&&s(`validating field "${u}"`),r&&!l?.value)return o&&this.validationMessages&&u&&(o.textContent=this.validationMessages[u]?this.validationMessages[u].empty:this.validationMessages.default.empty),this.displayFieldError({control:l,field:t,errorElement:o}),!1;if(l?.value){if(c&&l.value.length<c)return o&&this.validationMessages&&(o.textContent=this.validationMessages.default.minLength.replace("[[var]]",c.toString())),this.displayFieldError({control:l,field:t,errorElement:o}),!1;if(h&&l.value.length>h)return o&&this.validationMessages&&(o.textContent=this.validationMessages.default.maxLength.replace("[[var]]",h.toString())),this.displayFieldError({control:l,field:t,errorElement:o}),!1}if(i&&!n){if(!a)return this.displayFieldError({control:l,field:t,errorElement:o}),o&&this.validationMessages&&u&&(o.textContent=this.validationMessages[u]?this.validationMessages[u].empty:this.validationMessages.default.empty),!1}else{switch(e){case"email":if(l&&l.value&&!this.isValidEmail({email:l.value}))return o&&this.validationMessages&&(o.textContent=this.validationMessages.email.invalid),this.displayFieldError({control:l,field:t,errorElement:o}),!1;break;case"password_repeat":{const e=document.getElementById("password");if(e&&l?.value!=e?.value)return o&&this.validationMessages&&(o.textContent=this.validationMessages.password_repeat.unequal),this.displayFieldError({control:l,field:t,errorElement:o}),!1;break}case"cuil":case"cuit":if(l&&l.value&&!this.isValidCuitCuil({num:l.value}))return o&&this.validationMessages&&(o.textContent=this.validationMessages.cuil.invalid),this.displayFieldError({control:l,field:t,errorElement:o}),!1;break;case"url":if(l&&l.value&&!this.isValidUrl({urlString:l.value}))return o&&this.validationMessages&&(o.textContent=this.validationMessages.url.invalid),this.displayFieldError({control:l,field:t,errorElement:o}),!1;break;case"money":if(l){const e=l.dataset.currency?l.dataset.currency:"$";if(""==l.value||l.value==e)return o&&this.validationMessages&&(o.textContent=this.validationMessages.default.empty),this.displayFieldError({control:l,field:t,errorElement:o}),!1}break;case"single-checkbox":if(l&&l.hasOwnProperty("checked")){if(!l.checked)return this.displayFieldError({control:l,field:t,errorElement:o}),o&&this.validationMessages&&u&&(o.textContent=this.validationMessages[u]?this.validationMessages[u].empty:this.validationMessages.default.empty),!1}}for(const i of d)if(e===i)for(const i of this.customValidations[e])if(l&&!i.condition(l.value))return o&&(o.textContent=i.message||""),this.displayFieldError({control:l,field:t,errorElement:o}),!1}return!0}isValidEmail({email:t}){return/(?!.*\.{2})^([a-z\d!#$%&'*+\-/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([\t]*\r\n)?[\t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([\t]*\r\n)?[\t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i.test(t.toLowerCase())}isValidCuitCuil({num:t}){const e=[5,4,3,2,7,6,5,4,3,2];let i=t.toString().replace(/[^0-9]/g,"").split("");if(11!=i.length)return!1;i=i.map((t=>Number(t)));const s=Number(i.pop());let r=11-i.reduce(((t,i,s)=>t+Number(i)*e[s]),0)%11;return 10==r&&(r=9),11==r&&(r=0),r==s}isValidUrl({urlString:t}){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(t)}isValidFileSize({field:t}){let e=null;const i=t.querySelector(".form__control"),s=Number(t.dataset.minSize),r=Number(t.dataset.maxSize),a=t.querySelector(".form__error"),o=i&&i.files?i.files[0].name:null,l=i&&i.files?i.files[0].size:0,n=i&&i.files?parseFloat((l/1048576).toFixed(1)):0;n>r||!l?(i&&(i.value="",i.setAttribute("aria-invalid","true")),t.classList.remove("--has-file"),t.classList.add(this.classes.fieldHasError)):o?t.classList.add("--has-file"):t.classList.remove("--has-file"),this.validationMessages&&(l?n<s?e=this.validationMessages.file.min_size.replace("[[var]]",s+" MB"):n>r&&(e=this.validationMessages.file.max_size.replace("[[var]]",r+" MB")):e=this.validationMessages.file.empty),e&&a&&(a.textContent=e,this.displayFieldError({control:i,field:t,errorElement:a}))}displayFieldError({control:t,field:e,errorElement:i}){t&&(t.setAttribute("aria-invalid","true"),e.classList.add(this.classes.fieldHasError),this.classes.controlHasError&&t.classList.add(this.classes.controlHasError),i&&i.classList.remove(this.classes.hiddenErrorMessage))}clearControlError({control:t}){if(!t)return;t.setAttribute("aria-invalid","false"),this.classes.controlHasError&&t.classList.remove(this.classes.controlHasError);const e=i({element:t,className:"form__field"}),s=e?.querySelector(".form__error");e?.classList.remove(this.classes.fieldHasError),s&&(s.textContent="",s.classList.add(this.classes.hiddenErrorMessage))}realTimeValidations({form:t}){t.querySelectorAll('.form__field[data-type="file"]').forEach((t=>{const e=t.querySelector(".form__control");e?.addEventListener("change",(e=>{e.stopPropagation(),this.isValidFileSize({field:t})}))}))}throwError(t){throw new Error(`EgoForm Error: ${t}`)}}var o,l,n,u,d,c,h,m,f,p,g;o=new WeakSet,l=function(t){t.preventDefault(),"function"==typeof this.onBeforeSubmit&&this.onBeforeSubmit(this),this.submit()},n=function(t){const e=t.target,i=!!e&&this.validator.validateField({field:e});e&&!i&&(this.isValid=!1)},u=function(t){const e=t.target,s=i({element:e,className:"form__field"});this.validator.validateField({field:s})&&this.validator.clearControlError({control:e})},d=function(t){const e=t.target;this.isControlFilled({control:e})},c=function(t){const e=t.target;this.validator.clearControlError({control:e})},h=function(t){const e=t.target,s=i({element:e,className:"form__field"});s&&this.validator.clearControlError({control:s.querySelector(".form__control")})},m=function(t){const e=t.type,s=t.target,r=i({element:s,className:"form__field"}),a=r&&r.dataset.decimalSeparator?r.dataset.decimalSeparator:"",o=r&&r.dataset.thousandsSeparator?r.dataset.thousandsSeparator:"",l=r&&r.dataset.decimals?r.dataset.decimals:"";"blur"===e?s.value===o?s.value=this.filterFormattedQuantity({num:s.value,thousands:o,decimals:a,decimalSteps:parseInt(l,10)}):s.value=this.filterNumber({value:s.value,ignoreList:[]}):s.value=this.filterNumber({value:s.value,ignoreList:[a]})},f=function(t){const e=t.type,s=t.target,r=i({element:s,className:"form__field"}),a=r&&r.dataset.decimalSeparator?r.dataset.decimalSeparator:"";if("blur"===e){const t=r&&r.dataset.currency?r.dataset.currency:"$",e=r&&r.dataset.thousandsSeparator?r.dataset.thousandsSeparator:"",i=r&&r.dataset.decimals?r.dataset.decimals:"";s.value=this.filterMoneyAmount({num:s.value,currency:t,thousands:e,decimals:a,decimalSteps:parseInt(i,10)})}else s.value=this.filterNumber({value:s.value,ignoreList:[a]})},p=function(t){const e=t.target;e.value=this.filterPhoneNumber({number:e.value})},g=function(t){const e=t.target;this.togglePasswordVisibility({btn:e})},module.exports=class{constructor({element:t,classes:e,submitType:i,submitDataFormat:r,submitUrl:l,requestHeaders:n,fieldGroups:u,extraFields:d,serializerIgnoreList:c,customValidations:h,customValidationMessages:m,onStepChange:f,onValidationError:p,onSubmitStart:g,onSubmitEnd:F,onSuccess:v,onError:b,onBeforeSubmit:E,resetOnSuccess:S,resetLoaderOnSuccess:y,scrollOnError:_,scrollOnErrorOffset:L,preventSubmit:x,disbleStepsTransition:D,debug:w}){o.add(this),this.form=t,this.submitType=i||"fetch",this.submitDataFormat=r||"formData",this.requestHeaders=n||{},this.actionUrl=this.form.getAttribute("action")||l||null,this.submitMethod=this.form.getAttribute("method")||"POST",this.submitBtn=this.form.querySelector('button[type="submit"]')||null,this.classes={requiredField:"--required",requiredIfFilledField:"--required-if-filled",fieldHasError:"--has-error",hiddenErrorMessage:"--hidden",formSubmittingState:"--submitting",buttonSubmittingState:"--loading",clearFieldError:"--clear-error",validateOnBlur:"--validate-onblur",validateOnInput:"--validate-oninput",...e},this.isValid=!0,this.validator=new a({customValidations:h||{},classes:this.classes,customValidationMessages:m||null,debug:w??!1}),this.onValidationError=p??null,this.onStepChange=f??null,this.onSubmitStart=g??null,this.onSubmitEnd=F??null,this.onSuccess=v??null,this.onError=b??null,this.onBeforeSubmit=E??null,this.fieldGroups=u??null,this.extraFields=d??[],this.hasFile=!1,this.serializerIgnoreList=c||[],this.resetOnSuccess=S??!0,this.resetLoaderOnSuccess=y??!0,this.scrollOnError=_??!0,this.scrollOnErrorOffset=L||0;const C=this.form.querySelector(".form__step.--active");if(this.currentStep=C?Number(C.dataset.step):0,this.currentStepOptional=!1,this.disbleStepsTransition=D??!1,this.stepChanging=!1,this.preventSubmit=x??!1,this.debug=w??!1,this.declareHandlers(),!this.actionUrl||""===this.actionUrl)throw new Error("The form doesn't have an action attribute or submitUrl wasn't provided.");if(!this.submitBtn)throw new Error(`There's no submit button in this form "${this.form.id}".`);this.debug&&s("initialized!")}submit(){this.preventSubmit||this.resumeSubmit()}resumeSubmit(){this.debug&&s(`submitting using ${this.submitType}!`),this.submittingForm({submitting:!0}),this.isValid=!0;const t=[];if(this.form.querySelectorAll(".form__field").forEach((e=>{if(!this.validator.validateField({field:e})){const i=e.querySelector(".form__control");i&&t.push(i.name),this.isValid=!1}})),this.isValid)if(this.debug)s("the form was submitted!"),s(JSON.parse(this.serializeData({returnFormData:!1})),"data"),setTimeout((()=>{this.submittingForm({submitting:!1,force:!0})}),1e3);else if("fetch"==this.submitType&&this.actionUrl){const t=this.serializeData({returnFormData:"formData"===this.submitDataFormat});fetch(this.actionUrl,{method:this.submitMethod,headers:{...this.requestHeaders},body:t}).then((t=>{200===t.status||201===t.status?(this.resetOnSuccess&&this.reset(),"function"==typeof this.onSuccess&&this.onSuccess(t)):"function"==typeof this.onError&&this.onError(t)})).catch((t=>{"function"==typeof this.onError&&this.onError(t)})).finally((()=>{this.submittingForm({submitting:!1})}))}else{if("fetch"==this.submitType&&!this.actionUrl)throw new Error("Missing submit URL: When using 'fetch' submitType, specify either the form's 'action' or the 'submitUrl' option.");this.form.submit()}else if(this.submittingForm({submitting:!1,force:!0}),"function"==typeof this.onValidationError&&this.onValidationError(t,this),this.debug&&s(`this fields have failed validation: ${t.toString().replace(/,/g,", ")}.`),this.scrollOnError){const t=this.form.querySelector(`.form__field.${this.classes.fieldHasError}`);t&&!(({element:t})=>{const e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)})({element:t})&&(e=t,i=this.scrollOnErrorOffset||0,e&&window.scrollTo({behavior:"smooth",top:e.getBoundingClientRect().top-document.body.getBoundingClientRect().top-i}))}var e,i}submittingForm({submitting:t,force:e=!1}){let i=document.getElementsByTagName("body").item(0);t?(this.form.classList.add(this.classes.formSubmittingState),this.submitBtn&&this.submitBtn.classList.add(this.classes.buttonSubmittingState),i&&i.classList.add("--block"),"function"==typeof this.onSubmitStart&&this.onSubmitStart()):((this.resetLoaderOnSuccess||e)&&(this.form.classList.remove(this.classes.formSubmittingState),this.submitBtn&&this.submitBtn.classList.remove(this.classes.buttonSubmittingState),i&&i.classList.remove("--block")),"function"==typeof this.onSubmitEnd&&this.onSubmitEnd())}serializeData({returnFormData:t=!1}){const e=new FormData(this.form),i={};for(const t of e){const[e,s]=t;if(!this.serializerIgnoreList.includes(e)){if(s instanceof File&&!s.size&&!s.name)continue;i.hasOwnProperty(e)?i[e]=[...i[e],s]:i[e]=s}}if(this.fieldGroups)for(const t in this.fieldGroups)if(Object.hasOwnProperty.call(this.fieldGroups,t)){let s=[{}];for(const r of this.fieldGroups[t])s[0][r]=e.get(r),delete i[r];i[t]=s}if(this.extraFields.length)for(const t of this.extraFields)t.hasOwnProperty("name")&&t.hasOwnProperty("value")&&(e.append(t.name,t.value),i[t.name]=t.value);return t?e:JSON.stringify(i)}reset(){this.form.reset(),this.form.querySelectorAll(".form__field").forEach((t=>t.classList.remove("--filled",`${this.classes.fieldHasError}`))),this.form.querySelectorAll(".form__control").forEach((t=>t.setAttribute("aria-invalid","false"))),this.currentStep&&this.changeStep({step:1})}changeStep({step:t}){if(!this.stepChanging){const i=this.currentStepOptional?this.currentStep.toString()+"b":this.currentStep.toString(),s=this.form.querySelector('[data-step="'+i+'"]'),r=s?.querySelectorAll(`.${this.classes.requiredField}`),a="next"===t?this.currentStep+1:"prev"!==t||this.currentStepOptional?"optional"===t?this.currentStep+"b":this.currentStep:this.currentStep-1,o=this.form.querySelector('[data-step="'+a+'"]');if(this.currentStep!==a||this.currentStepOptional)if(this.stepChanging=!0,this.isValid=!0,!r||"next"!==t&&"optional"!==t||r.forEach((t=>this.isValid=this.validator.validateField({field:t}))),s&&o&&this.isValid){const r=()=>{o.classList.add("--active"),this.stepChanging=!1,this.currentStepOptional="optional"===t,this.currentStep=parseInt(a),"function"==typeof this.onStepChange&&this.onStepChange(i.toString(),a.toString())};this.disbleStepsTransition?(s.classList.remove("--active"),r()):e({element:s,enter:!1,time:200,displayType:"flex",callback:()=>{s.classList.remove("--active"),e({element:o,enter:!0,time:200,displayType:"flex",callback:r})}})}else this.stepChanging=!1}}nextStep(){this.changeStep({step:"next"})}optionalStep(){this.changeStep({step:"optional"})}prevStep(){this.changeStep({step:"prev"})}isControlFilled({control:t}){let e=t.parentElement;e&&(""!==t.value?e.classList.add("--filled"):e.classList.remove("--filled"))}filterNumber({value:t,ignoreList:e=[]}){const i=e.join(""),s=new RegExp("[^"+i+"0-9]","g");return t.toString().replace(s,"")}filterFormattedQuantity({num:t,thousands:e=".",decimals:i=",",decimalSteps:s}){const r=i?t.toString().trim().split(i):[t.toString()],a=new RegExp(/\B(?=(\d{3})+(?!\d))/g),o=r[0].replace(a,e);let l="";return l=s&&s>0&&r[1]&&r[1].length?o+i+r[1].slice(0,s):o,l}filterMoneyAmount({num:t,currency:e="$",thousands:i=".",decimals:s=",",decimalSteps:r}){if(!t||t==e)return"";let a=this.filterNumber({value:t,ignoreList:[s||""]});return a=this.filterFormattedQuantity({num:a,thousands:i,decimals:s,decimalSteps:r}),`${e} ${a}`}filterPhoneNumber({number:t}){let e=new RegExp(/[^\d+\-() ]*/g);return t.replace(e,"").trim()}togglePasswordVisibility({btn:t}){this.debug&&s("Password visibility toggled!");const e=t?.parentElement?.querySelector(".form__control");if(e){const i="password"===e.getAttribute("type")?"text":"password";e.setAttribute("type",i),t.classList.toggle("--hide")}}declareHandlers(e=!1){const i=this;!e&&this.submitBtn&&this.submitBtn.addEventListener("click",t(i,o,"m",l)),this.validator.realTimeValidations({form:this.form}),this.form.querySelectorAll(`.form__field.${this.classes.validateOnBlur}`).forEach((e=>{e.querySelector(".form__control")?.addEventListener("blur",t(this,o,"m",n))})),this.form.querySelectorAll(`.form__field.${this.classes.validateOnInput}`).forEach((e=>{const i=e.querySelector(".form__control");i?.addEventListener("input",t(this,o,"m",u))})),e||(this.form.querySelectorAll(".form__next-step").forEach((t=>{t.addEventListener("click",i.nextStep.bind(i))})),this.form.querySelectorAll(".form__optional-step").forEach((t=>{t.addEventListener("click",i.optionalStep.bind(i))})),this.form.querySelectorAll(".form__prev-step").forEach((t=>{t.addEventListener("click",i.prevStep.bind(i))}))),this.form.querySelectorAll(".form__control").forEach((e=>{this.isControlFilled({control:e}),e.addEventListener("keyup",t(this,o,"m",d)),e.addEventListener("change",t(this,o,"m",d))})),this.form.querySelectorAll(".form__control").forEach((e=>e.addEventListener("focus",t(this,o,"m",c)))),this.form.querySelectorAll("."+this.classes.clearFieldError).forEach((e=>e.addEventListener("click",t(this,o,"m",h)))),this.form.querySelectorAll(".form__field.--number input").forEach((e=>{e.addEventListener("focus",t(this,o,"m",m)),e.addEventListener("input",t(this,o,"m",m)),e.addEventListener("paste",t(this,o,"m",m)),e.addEventListener("blur",t(this,o,"m",m))})),this.form.querySelectorAll(".form__field.--money-amount input").forEach((e=>{e.addEventListener("focus",t(this,o,"m",f)),e.addEventListener("input",t(this,o,"m",f)),e.addEventListener("paste",t(this,o,"m",f)),e.addEventListener("blur",t(this,o,"m",f))})),this.form.querySelectorAll(".form__field.--phone input").forEach((e=>{e.addEventListener("input",t(this,o,"m",p)),e.addEventListener("paste",t(this,o,"m",p))})),this.form.querySelectorAll(".form__toggle-password-visibility").forEach((e=>e.addEventListener("click",t(this,o,"m",g))))}refresh(){console.log("Refreshing form..."),this.declareHandlers(!0)}};
